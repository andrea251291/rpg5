<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Mini Mappa – Stile Pokémon</title>
<style>
  /*  layout di base  */
  html,body{margin:0;height:100%;background:#000;display:flex;justify-content:center;align-items:center}
  #game{border:1px solid #555;image-rendering:pixelated}
  #message{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.8);color:#fff;padding:20px;font-size:24px;display:none}
</style>
</head>
<body>
<canvas id="game" width="320" height="160"></canvas>
<!--
  Sostituisci "tileset.png" e "player.png" con i tuoi sprite.
  ⚠️  tileset.png → riga orizzontale di 3 tile 16×16 px nell’ordine: pavimento, roccia, uscita.
  ⚠️  player.png  → riga orizzontale di 3 frame 16×16 px (animazione passo) rivolti in basso.
-->
<img id="tileset" src="assetaudiovideo/tileset.png" hidden>
<img id="playerSprite" src="assetaudiovideo/player.png" hidden>

<div id="message">Livello superato</div>
<script>
/******************
 * Costanti       *
 ******************/
const tileSize   = 16;
const mapWidth   = 20;
const mapHeight  = 10;
// 0: pavimento | 1: roccia | 2: uscita
const map = [
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1],
  [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1],
  [0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1],
  [0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,1],
  [0,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1],
  [0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1],
  [0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1],
  [0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,2],
  [0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1]
];

/******************
 * Stato Giocatore*
 ******************/
const player = { x:0, y:8, frame:0, dir:'down', animTick:0 };

/******************
 * Canvas & Img   *
 ******************/
const canvas   = document.getElementById('game');
const ctx      = canvas.getContext('2d');
ctx.imageSmoothingEnabled = false; // mantiene i pixel netti

const tileset  = document.getElementById('tileset');
const playerImg= document.getElementById('playerSprite');
const message  = document.getElementById('message');

// mappa indice→colonna sul tileset
const tileIdx = { 0:0, 1:1, 2:2 };

/******************
 * Flash Dynamics *
 ******************/
let darkness = true;               // tunnel buio di default
const radiusDefault = 32;          // raggio standard (~2 tile)
const radiusFlash   = 160;         // raggio quando il flash è attivo
let currentRadius   = radiusDefault;

/******************
 * Disegno         *
 ******************/
function drawMap(){
  for(let y=0;y<mapHeight;y++){
    for(let x=0;x<mapWidth;x++){
      const t = map[y][x];
      const sx = tileIdx[t]*tileSize;
      ctx.drawImage(tileset, sx, 0, tileSize, tileSize, x*tileSize, y*tileSize, tileSize, tileSize);
    }
  }
}

function drawPlayer(){
  // tre frame consecutivi (0,1,2) sulla stessa riga
  ctx.drawImage(playerImg, player.frame*tileSize, 0, tileSize, tileSize,
                player.x*tileSize, player.y*tileSize, tileSize, tileSize);
}

function drawDarkness(){
  if(!darkness) return;                     // se il flash è attivo non disegnare l'oscurità
  ctx.fillStyle = 'rgba(0,0,0,0.85)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.save();
  ctx.globalCompositeOperation = 'destination-out';
  ctx.beginPath();
  ctx.arc(player.x*tileSize + tileSize/2, player.y*tileSize + tileSize/2,
          currentRadius, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMap();
  drawPlayer();
  drawDarkness();
}

/******************
 * Input Tastiera  *
 ******************/
document.addEventListener('keydown', e=>{
  const {x,y}=player;
  if(e.key==='f' || e.key==='F'){
    darkness = !darkness;                              // attiva/disattiva il flash
    currentRadius = darkness ? radiusDefault : radiusFlash;
    render();
    return;                                           // evita altro input
  }

  let nx=x, ny=y;
  if(e.key==='ArrowUp')   ny--;
  if(e.key==='ArrowDown') ny++;
  if(e.key==='ArrowLeft') nx--;
  if(e.key==='ArrowRight')nx++;

  if(nx<0||nx>=mapWidth||ny<0||ny>=mapHeight) return;          // bordo
  if(map[ny][nx]===1) return;                                   // roccia

  player.x=nx; player.y=ny;

  // semplice animazione a 2 frame
  player.frame = (player.frame+1)%2;

  if(map[ny][nx]===2){
    message.style.display='block';
  }
  render();
});

/******************
 * Avvio           *
 ******************/
function start(){
  if(tileset.complete && playerImg.complete){
    render();
  } else {
    // aspetta il caricamento delle immagini
    tileset.onload=start;
    playerImg.onload=start;
  }
}
start();
</script>
</body>
</html>
